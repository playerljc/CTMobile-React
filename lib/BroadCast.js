"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"))),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));function getReceiverByIntent(e){for(var r=[],t=0,i=this.receiverModel.length;t<i;t++){var n=this.receiverModel[t];if(n.action===e.action&&n.categorys.length===e.categorys.length){for(var l=!0,a=0;a<e.categorys.length;a++)if(-1===n.categorys.indexOf(e.categorys[a])){l=!1;break}l&&r.push(n)}}return r}var BroadCast=function(){function e(){(0,_classCallCheck2.default)(this,e),Object.assign(this,{receiverModel:[]})}return(0,_createClass2.default)(e,[{key:"executeReceiverById",value:function(e,r){for(var t=0,i=this.receiverModel.length;t<i;t++){var n=this.receiverModel[t];n.innerReceiverId===e&&n.handler&&n.handler(r)}}},{key:"registerReceiver",value:function(e,r){r&&e&&e.action&&e.el&&this.receiverModel.push({el:e.el,action:e.action,categorys:e.categorys||[],handler:r,priority:e.priority||0,context:2<arguments.length&&void 0!==arguments[2]?arguments[2]:this})}},{key:"unregisterReceiver",value:function(e,r){if(e&&r)for(var t=0;t<this.receiverModel.length;){var i=this.receiverModel[t];i.action===e&&i.handler===r?(this.receiverModel.splice(t,1),t=0):t++}}},{key:"unregisterReceiverByDom",value:function(e){if(e)for(var r=0;r<this.receiverModel.length;)this.receiverModel[r].el===e?(this.receiverModel.splice(r,1),r=0):r++}},{key:"sendBroadcast",value:function(e){if(e)for(var r=getReceiverByIntent.call(this,e),t=0,i=(r=[].concat(r)).length;t<i;t++)r[t].handler&&r[t].handler.call(r[t].context,Object.assign({},e))}},{key:"sendOrderedBroadcast",value:function(e){var r,i=0,n=!1,l={action:e.action,categorys:e.categorys||[],bundles:[]};e&&(r=getReceiverByIntent.call(this,e),(r=[].concat(r)).sort(function(e,r){e=e.priority||0,r=r.priority||0;return e<r?1:r<e?-1:0}),l.bundles.push(e.bundle||{}),function e(r){if(0===r.length)return;var t=r.shift();t&&(i++,n=!0,t.handler.call(t.context,l,{next:function(){n=!1,l.bundles.length!==i+1&&l.bundles.push({}),e(r)},putExtras:function(e){n&&(l.bundles.length===i+1&&l.bundles.pop(),l.bundles.push(e))}}))}(r))}}]),e}(),_default=BroadCast;exports.default=_default;